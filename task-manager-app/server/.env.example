# Environment Variables Guide

Copia il contenuto di questo file in `server/.env` e personalizza i valori.

## Database Configuration

```env
# SQLite connection string (file-based)
DATABASE_URL="file:./data/tasks.db"
```

Per usare un altro database:
- **PostgreSQL**: `DATABASE_URL="postgresql://user:password@localhost:5432/task_manager"`
- **MySQL**: `DATABASE_URL="mysql://user:password@localhost:3306/task_manager"`

## JWT Configuration

```env
# Secret key per firmare i token JWT
# IMPORTANTE: Genera una stringa casuale sicura per production
# Es: openssl rand -base64 32
JWT_SECRET="your_jwt_secret_key_change_this"

# Token expiry: 8 ore
# Configurabile nel controller se necessario
```

## Server Configuration

```env
# Porta di ascolto
PORT=5000

# Environment mode
NODE_ENV=development  # o "production"
```

## Default Master User

```env
# Credenziali dell'utente master di default (creato al primo seed)
DEFAULT_MASTER_USER="master"
DEFAULT_MASTER_PASS="masterpass"
```

## Development Settings

```env
# Log level
LOG_LEVEL=debug  # debug, info, warn, error

# CORS Origins (accetta richieste da questi siti)
CORS_ORIGIN="http://localhost:3000,http://localhost:5000"

# Database debug
DATABASE_DEBUG=false  # Abilita query logging
```

## Example Complete .env

```env
# ============================================
# DATABASE
# ============================================
DATABASE_URL="file:./data/tasks.db"

# ============================================
# AUTHENTICATION
# ============================================
JWT_SECRET="super_secret_key_change_me_in_production_12345"

# ============================================
# SERVER
# ============================================
PORT=5000
NODE_ENV=development

# ============================================
# DEFAULT MASTER
# ============================================
DEFAULT_MASTER_USER="master"
DEFAULT_MASTER_PASS="masterpass"

# ============================================
# OPTIONAL
# ============================================
LOG_LEVEL=info
CORS_ORIGIN="*"
```

## Production Checklist

Prima di deployare su production, verifica:

- [ ] `JWT_SECRET` è una stringa casuale forte
  ```bash
  # Genera con:
  openssl rand -base64 32
  ```

- [ ] `NODE_ENV=production`

- [ ] `DATABASE_URL` punta al database corretto

- [ ] Cambiate credenziali default master
  ```env
  DEFAULT_MASTER_USER="nuovo_username"
  DEFAULT_MASTER_PASS="nuova_password_forte"
  ```

- [ ] `CORS_ORIGIN` limitato ai domini autorizzati

- [ ] Backup del database prima di migrare

## Database Migrations

Se aggiungi nuovi campi o tabelle:

```bash
# Modifica server/prisma/schema.prisma

# Sincronizza il database
npx prisma db push --schema=server/prisma/schema.prisma

# Opzionale: crea migrazioni
npx prisma migrate dev --name "descrizione_migrazione"
```

## Development Tips

### Hot Reload
```bash
npm run dev  # Riavvia automaticamente al cambio file
```

### Database Reset
```bash
# Elimina database e ricrea
rm server/data/tasks.db
npm run prisma:seed
```

### View Database
```bash
# Apri GUI per visualizzare database
npx prisma studio
```

## Troubleshooting

### Errore: "Environment variable not found: DATABASE_URL"
- Verifica che `server/.env` esista
- Verifica che `DATABASE_URL` sia definito
- Esegui da directory `task-manager-app`

### Errore: "Invalid JWT_SECRET"
- Assicurati che `JWT_SECRET` non sia vuoto
- Usa una stringa con almeno 32 caratteri

### Errore: "Database locked"
- Il database SQLite è in uso da altro processo
- Chiudi il server: `npm stop`
- Riavvia: `npm start`

## Environment by Deployment

### Local Development
```env
DATABASE_URL="file:./data/tasks.db"
JWT_SECRET="dev_secret_key_123"
NODE_ENV=development
PORT=5000
```

### Staging
```env
DATABASE_URL="postgresql://user:pass@staging-db.com:5432/task_manager"
JWT_SECRET="[random_strong_key_from_vault]"
NODE_ENV=staging
PORT=5000
CORS_ORIGIN="https://staging.example.com"
```

### Production
```env
DATABASE_URL="postgresql://user:pass@prod-db.com:5432/task_manager"
JWT_SECRET="[strong_random_key_from_vault]"
NODE_ENV=production
PORT=5000
CORS_ORIGIN="https://example.com,https://app.example.com"
LOG_LEVEL=warn
```

## Secret Management

Per production, usa un servizio di secret management:

- **AWS Secrets Manager**: `aws secretsmanager get-secret-value`
- **HashiCorp Vault**: Ambiente da chiave centralizzata
- **GitHub Secrets**: Per CI/CD pipelines
- **Vercel Secrets**: Se deployato su Vercel

Esempio con AWS:
```bash
#!/bin/bash
export JWT_SECRET=$(aws secretsmanager get-secret-value --secret-id task-manager/jwt-secret --query SecretString --output text)
export DATABASE_URL=$(aws secretsmanager get-secret-value --secret-id task-manager/db-url --query SecretString --output text)
npm start
```

---

**Nota**: Mai committare `.env` nel repository! Usa `.env.example` come template.
